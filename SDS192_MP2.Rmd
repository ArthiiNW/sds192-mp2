---
title: "MiniProject2"
author: "Yingqi Zheng, Xufen Liu, Jingjing Hu"
date: "10/23/2017"
output: html_document
---

```{R message = FALSE}
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```

```{R message = FALSE}
library(ggplot2)
library(tidyverse)
library(readr)
```

```{R}
select_candyear <- function(yearselect) {
  candidates %>%
  select(-cand_office_district, -cand_status, -cand_city, -cand_state) %>%
  filter(cand_election_yr == yearselect) %>%
  filter(cand_office == "S") 
}

candyear <- select_candyear(yearselect = "2012")

contritidy <- contributions %>%
  select(cmte_id, name, state, cand_id, transaction_amt)
```


```{r}
contricand <-candyear %>%
  right_join(contritidy, by = "cand_id") %>%
  filter(cand_office == "S") %>%
  filter(!is.na(cand_name)) %>%
  arrange(cand_office_state)
```

```{R}
party <- contricand %>%
  group_by(cand_office_state, cand_party_affiliation) %>%
  summarise(partydonation = sum(transaction_amt)) %>%
  spread(key = cand_party_affiliation, value = partydonation)

party[is.na(party)] <- 0
```

```{R}
party2 <- party %>%
  mutate(total = DEM + REP + IND + LIB + SUS + GRE) %>%
  mutate (DEMtototal = DEM/total)
```

```{r message = FALSE}
result <- read_csv("~/sds192-mp2/Swinner.csv")

party3 <- party2 %>%
  right_join(result, by = "cand_office_state")
```

```{r}
candplot <- ggplot(data = party3, aes(x = cand_office_state, y = DEMtototal), alpha = 0.2) + 
  geom_point(aes(col= Winner)) +
  scale_colour_manual (values= as.character(c(high="blue2", mid ="black", low = "red2"))) +
  geom_hline(yintercept = 0.5) +  
  labs(title = "% Money Received by Democrat") +
  ylab(label = "Percentage") +
  xlab(label = "States") +
  theme(plot.title = element_text(hjust = 0.5))

candplot
```
